:80 {
	# Enable compression
	encode gzip zstd

	# Handle API requests - must be first!
	handle /api/* {
		# CORS headers
		header Access-Control-Allow-Origin https://letstestit.me
		header Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
		header Access-Control-Allow-Headers "Content-Type, Authorization"
		header Access-Control-Allow-Credentials true

		# Handle OPTIONS requests
		@options method OPTIONS
		respond @options "" 200

		# Proxy to backend service in Docker
		reverse_proxy backend:3001
	}

	# Handle capacity endpoint
	handle /capacity {
		header Access-Control-Allow-Origin https://letstestit.me
		header Access-Control-Allow-Methods "GET, OPTIONS"
		header Access-Control-Allow-Headers "Content-Type, Authorization"
		header Access-Control-Allow-Credentials true

		@options method OPTIONS
		respond @options "" 200

		reverse_proxy backend:3001
	}

	# Handle everything else - serve frontend
	handle {
		root * /srv
		try_files {path} /index.html
		file_server
	}
}
